from sodapy import Socrata
import pandas as pd 
from work import APP_TOKEN

def ingestion(token=APP_TOKEN, limit=50000):
     client = Socrata("data.cityoforlando.net", app_token=token) 
     results = client.get("k6e8-nw6w", limit=limit)
     df = pd.DataFrame.from_records(results)

     df['casedt'] = pd.to_datetime(df['casedt'])
     df['year'] = df['casedt'].dt.year
     df['month'] = df['casedt'].dt.month
     df['day'] = df['casedt'].dt.day
     df['weekday'] = df['casedt'].dt.weekday

     df.sort_values(by='casedt', ascending=False, inplace=True)

     return df


df = ingestion()
df.to_csv("data/code_enforcement_data.csv", index=False)